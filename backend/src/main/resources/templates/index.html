<!-- List all databases and create new -->

<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Моите бази данни</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="p-3">

<h1 class="mb-4">Създай нова база</h1>

<div class="mb-3">
  <input type="text" id="dbName" placeholder="Име на базата" class="form-control mb-2" />
  <button id="createBtn" class="btn btn-primary">Създай база</button>
  <p id="message" style="color:red;"></p>
</div>

<h2 class="mt-4">Моите бази</h2>
<ul class="list-group" id="databasesList">
  <li th:if="${#lists.isEmpty(databases)}" class="list-group-item text-muted">
    Нямате създадени бази данни.
  </li>
  <li th:each="db : ${databases}" class="list-group-item d-flex justify-content-between align-items-center">
    <span th:text="${db.dbName}">DatabaseName</span>
    <div>
      <a th:href="@{'/db/' + ${db.dbName} + '/portfolio'}" 
                              class="btn btn-sm btn-success">View</a>
      <button type="button" class="btn btn-sm btn-danger" 
              th:attr="onclick=|deleteDb('${db.dbName}')|">Delete</button>
    </div>
  </li>
</ul>

<script>
async function deleteDb(dbName) {
  if (!confirm("Сигурни ли сте, че искате да изтриете базата " + dbName + "?")) return;

  try {
    const response = await fetch(`/db/delete/${encodeURIComponent(dbName)}`, { method: "POST" });
    const text = await response.text();

    if (response.ok) {
      alert(text);
      location.reload();
    } else {
      alert("Грешка: " + text);
    }
  } catch (err) {
    alert("Грешка при свързване със сървъра!");
    console.error(err);
  }
}

document.getElementById("createBtn").addEventListener("click", async () => {
  const dbName = document.getElementById("dbName").value.trim();
  const message = document.getElementById("message");
  message.textContent = "";

  if (!dbName) {
    message.textContent = "Моля, въведете име на базата!";
    return;
  }

  try {
    const response = await fetch(`/db/create?dbName=${encodeURIComponent(dbName)}`, { method: "POST" });
    const text = await response.text();

    if (response.ok) {
      message.style.color = "green";
      message.textContent = text;
      setTimeout(() => location.reload(), 500);
    } else {
      message.style.color = "red";
      message.textContent = text;
    }
  } catch (err) {
    message.style.color = "red";
    message.textContent = "Грешка при свързване със сървъра!";
    console.error(err);
  }
});
</script>

</body>
</html>
